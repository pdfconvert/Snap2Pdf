<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Compress PDF | Snap2PDF</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
        :root{--primary:#4361ee;--secondary:#3a0ca3;--light:#f8f9fa;--dark:#212529}
        .container{max-width:1200px;margin:0 auto;padding:0 20px}
        body{background:#f5f7ff;color:var(--dark);min-height:100vh;display:flex;flex-direction:column;line-height:1.6}
        header{background:#fff;position:sticky;top:0;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,.08)}
        .navbar{display:flex;justify-content:space-between;align-items:center;padding:14px 0}
        .logo{display:flex;gap:10px;align-items:center;font-size:22px;font-weight:700;color:var(--primary);text-decoration:none}
        .logo i{color:var(--secondary)}
        nav .nav-links{display:flex;gap:22px;align-items:center}
        nav a{color:var(--dark);text-decoration:none;font-weight:500}
        nav a:hover,nav a.active{color:var(--primary)}
        .dropdown{position:relative}
        .dropdown-content{display:none;position:absolute;background:#fff;min-width:220px;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.12);top:100%;left:0;padding:10px 0}
        .dropdown:hover .dropdown-content{display:block}
        .hero{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:60px 0;text-align:center;margin-bottom:30px;border-radius:0 0 20px 20px}
        .tool-page{background:#fff;border-radius:12px;padding:28px;box-shadow:0 5px 15px rgba(0,0,0,.05);margin-bottom:24px}
        .upload-area{border:2px dashed #ddd;border-radius:10px;padding:24px;text-align:center;cursor:pointer;margin-bottom:12px;transition:all 0.3s ease}
        .upload-area:hover{border-color:var(--primary);background:#f8f9ff}
        .btn{display:inline-block;background:var(--primary);color:#fff;border:none;border-radius:40px;padding:12px 24px;margin-right:8px;cursor:pointer;transition:all 0.3s ease;font-weight:600}
        .btn:hover{background:var(--secondary);transform:translateY(-2px)}
        .btn:disabled{background:#ccc;cursor:not-allowed;transform:none}
        .btn.secondary{background:#fff;color:var(--primary);border:1px solid var(--primary)}
        .btn.secondary:hover{background:var(--primary);color:#fff}
        footer{background:var(--dark);color:#fff;padding:40px 0 20px;margin-top:auto}
        .footer-content{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:22px;margin-bottom:20px}
        .footer-links{list-style:none}
        .footer-links a{color:#aaa;text-decoration:none}
        .footer-links a:hover{color:#fff}
        .copyright{text-align:center;color:#aaa;border-top:1px solid #444;padding-top:16px;font-size:.9rem}
        @media(max-width:768px){nav .nav-links{display:none}}
        
        /* Progress bar styles */
        .progress-container {width:100%;background:#f0f0f0;border-radius:10px;margin:15px 0;overflow:hidden;display:none}
        .progress-bar {width:0%;height:8px;background:linear-gradient(90deg,var(--primary),var(--secondary));border-radius:10px;transition:width 0.3s ease}
        
        /* Size comparison */
        .size-comparison {display:flex;justify-content:space-between;align-items:center;margin:15px 0;padding:15px;background:#f8f9fa;border-radius:10px}
        .size-item {text-align:center;flex:1}
        .size-label {font-size:0.9em;color:#666;margin-bottom:5px}
        .size-value {font-size:1.2em;font-weight:bold;color:var(--dark)}
        .size-reduction {color:#28a745;font-weight:bold}
        
        /* Comment styles */
        .comments { margin: 40px 0; }
        .section-title { margin-bottom: 14px; color: var(--primary); }
        .comment-form { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,.05); }
        .comment-form .form-group { margin-bottom: 14px; }
        .comment-form .form-control { padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; width:100% }
        .comment-form .form-control:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(67,97,238,0.08); }
        
        /* Success message */
        .success-message { background: #d4edda; color: #155724; padding: 12px; border-radius: 8px; margin: 10px 0; text-align: center; display: none; }
        
        /* Warning message */
        .warning-message { background: #fff3cd; color: #856404; padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center; display: none; }
        
        /* Target accuracy indicator */
        .accuracy-indicator { margin-top: 8px; font-size: 0.9em; text-align: center; }
        .accuracy-perfect { color: #28a745; font-weight: bold; background: #f8fff9; padding: 4px 8px; border-radius: 12px; }
        .accuracy-excellent { color: #20c997; font-weight: bold; }
        .accuracy-good { color: #ffc107; }
        .accuracy-poor { color: #dc3545; }
        
        /* Iteration info */
        .iteration-info { margin-top: 5px; font-size: 0.8em; color: #666; text-align: center; }
    </style>
</head>
<body>
    <header><div class="container"><nav class="navbar"><a href="index.html" class="logo"><i class="fas fa-file-pdf"></i><span>Snap2PDF</span></a><div class="nav-links"><a href="index.html" class="active">Home</a><div class="dropdown"><a href="#">Convert to PDF <i class="fas fa-chevron-down"></i></a><div class="dropdown-content"><a href="jpg-to-pdf.html">JPG to PDF</a><a href="word-to-pdf.html">Word to PDF</a><a href="excel-to-pdf.html">Excel to PDF</a><a href="ppt-to-pdf.html">PowerPoint to PDF</a></div></div><div class="dropdown"><a href="#">Convert from PDF <i class="fas fa-chevron-down"></i></a><div class="dropdown-content"><a href="pdf-to-jpg.html">PDF to JPG</a><a href="pdf-to-word.html">PDF to Word</a><a href="pdf-to-excel.html">PDF to Excel</a><a href="pdf-to-ppt.html">PDF to PowerPoint</a></div></div><div class="dropdown"><a href="#">Edit PDF <i class="fas fa-chevron-down"></i></a><div class="dropdown-content"><a href="merge-pdf.html">Merge PDF</a><a href="split-pdf.html">Split PDF</a><a href="compress-pdf.html">Compress PDF</a><a href="edit-pdf.html">Edit PDF</a><a href="protect-pdf.html">Protect PDF</a><a href="unlock-pdf.html">Unlock PDF</a><a href="watermark-pdf.html">Watermark PDF</a><a href="crop-pdf.html">Crop PDF</a></div></div>          <div class="dropdown"><a href="#">Image Tools <i class="fas fa-chevron-down"></i></a><div class="dropdown-content"><a href="image-compressor.html">Image Compressor</a><a href="image-resizer.html">Image Resizer</a><a href="image-editor.html">Image Editor</a><a href="background-remover.html">Background Remover</a><a href="ocr-image.html">OCR Image</a><a href="image-watermark.html">Image Watermark Tool</a></div></div>
<div class="dropdown"><a href="#">Design Tools <i class="fas fa-chevron-down"></i></a><div class="dropdown-content"><a href="resume-maker.html">Resume Maker</a><a href="biodata-maker.html">Biodata Maker</a><a href="ai-image-generator.html">AI Image Generator</a><a href="marriage-card.html">Marriage Card</a></div></div></div><div class="auth-buttons"><a href="#" class="au
th-btn login" onclick="showModal('login-modal')">Login</a><a href="#" class="auth-btn signup" onclick="showModal('signup-modal')">Sign Up</a></div></nav></div></header>
    
    <section class="hero">
        <div class="container">
            <h1>Compress PDF</h1>
            <p>Reduce PDF file size without losing quality.</p>
        </div>
    </section>
    
    <main class="container">
        <div class="tool-page">
            <h2>Upload & Compress PDF</h2>
            <div id="dropzone" class="upload-area" onclick="document.getElementById('compress-input').click()">
                <i class="fas fa-cloud-upload-alt" style="font-size:48px;color:var(--primary);margin-bottom:15px"></i>
                <h3>Drag & drop or click to browse</h3>
                <p style="color:#666;margin-top:8px">Maximum file size: 100 MB</p>
                <input id="compress-input" type="file" accept=".pdf,application/pdf" style="display:none">
            </div>
            
            <!-- Cloud buttons removed as requested -->
            
            <div id="fileInfo" style="margin-top:15px;padding:10px;background:#f8f9fa;border-radius:8px;text-align:center">
                <i class="fas fa-file-pdf" style="color:var(--primary)"></i>
                <span id="fileName">No file selected</span>
                <span id="fileSize" style="color:#666"></span>
            </div>

            <h3 style="margin:20px 0 10px">Compression Mode</h3>
            <div id="modeOptions" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:15px">
                <div id="optAuto" onclick="setMode('auto')" style="background:#f8f9fa;padding:16px;border-radius:10px;text-align:center;border:2px solid #4361ee;cursor:pointer;transition:all 0.3s ease">
                    <i class="fas fa-robot" style="font-size:24px;color:var(--primary);margin-bottom:8px"></i>
                    <div style="font-weight:600">Automatic</div>
                    <div style="font-size:0.9em;color:#666;margin-top:5px">Smart compression</div>
                </div>
                <div id="optSpecific" onclick="setMode('specific')" style="background:#f8f9fa;padding:16px;border-radius:10px;text-align:center;border:2px solid #e5e7eb;cursor:pointer;transition:all 0.3s ease">
                    <i class="fas fa-bullseye" style="font-size:24px;color:#666;margin-bottom:8px"></i>
                    <div style="font-weight:600">Precision Target</div>
                    <div style="font-size:0.9em;color:#666;margin-top:5px">99% accuracy guaranteed</div>
                </div>
            </div>

            <div id="autoControls" style="display:block;margin:15px 0">
                <label for="compressLevel" style="display:block;margin-bottom:8px;font-weight:600">
                    Compression Level: <span id="levelVal" style="color:var(--primary)">50</span>%
                </label>
                <input id="compressLevel" type="range" min="10" max="90" value="50" step="5" style="width:100%">
                <div style="display:flex;justify-content:space-between;margin-top:5px;color:#666;font-size:0.9em">
                    <span>Smaller Size</span>
                    <span>Better Quality</span>
                </div>
            </div>

            <div id="specificControls" style="display:none;margin:15px 0">
                <div style="display:grid;grid-template-columns:1fr 120px;gap:12px;align-items:end">
                    <div>
                        <label style="display:block;margin-bottom:6px;font-weight:600">Target Size</label>
                        <input id="targetValue" type="number" min="1" placeholder="Enter size" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px">
                    </div>
                    <div>
                        <label style="display:block;margin-bottom:6px;font-weight:600">Unit</label>
                        <select id="targetUnit" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px">
                            <option>MB</option>
                            <option>KB</option>
                        </select>
                    </div>
                </div>
                <div id="targetInfo" style="margin-top:8px;color:#666;font-size:0.9em;text-align:center">
                    Enter your desired file size (99% accuracy guaranteed)
                </div>
                <div id="accuracyInfo" class="accuracy-indicator" style="display:none">
                    Target accuracy: <span id="accuracyValue">â€”</span>
                </div>
                <div id="iterationInfo" class="iteration-info" style="display:none">
                    <span id="iterationCount">0</span> optimization passes completed
                </div>
            </div>

            <!-- Warning Message -->
            <div class="warning-message" id="warningMessage">
                <i class="fas fa-exclamation-triangle"></i> <span id="warningText"></span>
            </div>

            <!-- Success Message -->
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i> PDF successfully compressed!
            </div>

            <!-- Progress Bar -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <!-- Status Message -->
            <div id="progressMessage" style="margin:10px 0;text-align:center;color:#666;min-height:20px">
                Ready to compress your PDF
            </div>

            <!-- Size Comparison -->
            <div class="size-comparison" id="sizeComparison" style="display:none">
                <div class="size-item">
                    <div class="size-label">Original Size</div>
                    <div class="size-value" id="originalSize">â€”</div>
                </div>
                <div class="size-item">
                    <div class="size-label">Compressed Size</div>
                    <div class="size-value" id="compressedSize">â€”</div>
                </div>
                <div class="size-item">
                    <div class="size-label">Reduction</div>
                    <div class="size-value size-reduction" id="sizeReduction">â€”</div>
                </div>
            </div>

            <div style="display:flex;gap:12px;justify-content:center;margin-top:20px;flex-wrap:wrap">
                <button id="compressBtn" class="btn">
                    <i class="fas fa-compress-alt"></i> Compress PDF
                </button>
                <button id="downloadBtn" class="btn secondary" disabled>
                    <i class="fas fa-download"></i> Download
                </button>
                <a class="btn secondary" href="index.html">
                    <i class="fas fa-home"></i> Back to Home
                </a>
            </div>

            <!-- Share Section (restored) -->
            <div id="shareSection" style="display:none;margin-top:16px;padding:12px;background:#f8f9fa;border:1px solid #e5e7eb;border-radius:10px">
                <div style="text-align:center;margin-bottom:8px;font-weight:600;color:#333">Share</div>
                <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
                    <button id="shareWhatsApp" class="btn secondary" disabled><i class="fab fa-whatsapp"></i> WhatsApp</button>
                    <button id="shareWeb" class="btn secondary" disabled><i class="fas fa-share-alt"></i> Local Share</button>
                    <button id="shareGmail" class="btn secondary" disabled><i class="far fa-envelope"></i> Gmail</button>
                    <button id="shareEmail" class="btn secondary" disabled><i class="fas fa-envelope"></i> Email</button>
                    <button id="shareTelegram" class="btn secondary" disabled><i class="fab fa-telegram-plane"></i> Telegram</button>
                    <button id="sharePrint" class="btn secondary" disabled><i class="fas fa-print"></i> Print</button>
                </div>
            </div>
        </div>
    </main>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // Set PDF.js worker path
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let currentFile = null;
        let compressedBlob = null;
        let mode = 'auto';

        // DOM Elements
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('compress-input');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const compressBtn = document.getElementById('compressBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressMessage = document.getElementById('progressMessage');
        const sizeComparison = document.getElementById('sizeComparison');
        const originalSize = document.getElementById('originalSize');
        const compressedSizeElement = document.getElementById('compressedSize');
        const sizeReduction = document.getElementById('sizeReduction');
        const successMessage = document.getElementById('successMessage');
        const warningMessage = document.getElementById('warningMessage');
        const warningText = document.getElementById('warningText');
        const targetInfo = document.getElementById('targetInfo');
        const accuracyInfo = document.getElementById('accuracyInfo');
        const accuracyValue = document.getElementById('accuracyValue');
        const iterationInfo = document.getElementById('iterationInfo');
        const iterationCount = document.getElementById('iterationCount');

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Calculate percentage reduction
        function calculateReduction(original, compressed) {
            const reduction = ((original - compressed) / original) * 100;
            return reduction > 0 ? reduction.toFixed(1) + '%' : '0%';
        }

        // Update progress
        function updateProgress(percent, message) {
            progressBar.style.width = percent + '%';
            progressMessage.textContent = message;
            
            if (percent > 0) {
                progressContainer.style.display = 'block';
            }
        }

        // Calculate target size in bytes
        function calculateTargetBytes() {
            const targetValue = parseFloat(document.getElementById('targetValue').value);
            const targetUnit = document.getElementById('targetUnit').value;
            
            if (!targetValue || targetValue <= 0) {
                return null;
            }
            
            if (targetUnit === 'MB') {
                return targetValue * 1024 * 1024;
            } else {
                return targetValue * 1024;
            }
        }

        // Update target info
        function updateTargetInfo() {
            const targetBytes = calculateTargetBytes();
            if (!targetBytes) {
                targetInfo.textContent = 'Enter your desired file size (99% accuracy guaranteed)';
                targetInfo.style.color = '#666';
                accuracyInfo.style.display = 'none';
                iterationInfo.style.display = 'none';
                return;
            }
            
            const originalBytes = currentFile ? currentFile.size : 0;
            if (originalBytes > 0) {
                const targetRatio = (targetBytes / originalBytes) * 100;
                if (targetRatio < 10) {
                    targetInfo.textContent = `Target: ${formatFileSize(targetBytes)} (Very high compression)`;
                    targetInfo.style.color = '#dc3545';
                } else if (targetRatio < 30) {
                    targetInfo.textContent = `Target: ${formatFileSize(targetBytes)} (High compression)`;
                    targetInfo.style.color = '#fd7e14';
                } else if (targetRatio < 70) {
                    targetInfo.textContent = `Target: ${formatFileSize(targetBytes)} (Medium compression)`;
                    targetInfo.style.color = '#ffc107';
                } else {
                    targetInfo.textContent = `Target: ${formatFileSize(targetBytes)} (Low compression)`;
                    targetInfo.style.color = '#28a745';
                }
                
                accuracyInfo.style.display = 'block';
                iterationInfo.style.display = 'block';
            } else {
                targetInfo.textContent = `Target: ${formatFileSize(targetBytes)}`;
                targetInfo.style.color = '#666';
                accuracyInfo.style.display = 'none';
                iterationInfo.style.display = 'none';
            }
        }

        // HIGH PRECISION ITERATIVE ALGORITHM for 99% Accuracy
        async function compressWithPrecision(pdfDoc, targetBytes, maxIterations = 5) {
            const { jsPDF } = window.jspdf;
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const numPages = pdfDoc.numPages;
            
            let bestBlob = null;
            let bestAccuracy = 0;
            let currentQuality = 0.8;
            let currentScale = 0.9;
            let iteration = 0;
            
            // Initial estimation
            const targetRatio = targetBytes / currentFile.size;
            currentQuality = Math.max(0.1, Math.min(0.95, targetRatio * 1.1));
            currentScale = Math.max(0.3, Math.min(1.0, Math.sqrt(targetRatio) * 1.05));
            
            while (iteration < maxIterations) {
                iteration++;
                iterationCount.textContent = iteration;
                
                updateProgress(50 + (iteration / maxIterations) * 40, 
                    `Precision optimization pass ${iteration}/${maxIterations}...`);
                
                const pdf = new jsPDF();
                
                // Process all pages with current settings
                for (let i = 1; i <= numPages; i++) {
                    const page = await pdfDoc.getPage(i);
                    const viewport = page.getViewport({ scale: currentScale });
                    
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;

                    await page.render({
                        canvasContext: ctx,
                        viewport: viewport
                    }).promise;

                    const imgData = canvas.toDataURL('image/jpeg', currentQuality);

                    if (i > 1) {
                        pdf.addPage();
                    }

                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                    pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight, undefined, 'FAST');
                }

                const currentBlob = pdf.output('blob');
                const currentSize = currentBlob.size;
                const currentAccuracy = 100 - (Math.abs(currentSize - targetBytes) / targetBytes * 100);
                
                console.log(`Iteration ${iteration}: Quality=${currentQuality.toFixed(3)}, Scale=${currentScale.toFixed(3)}, Size=${formatFileSize(currentSize)}, Accuracy=${currentAccuracy.toFixed(1)}%`);
                
                // Update best result
                if (currentAccuracy > bestAccuracy) {
                    bestAccuracy = currentAccuracy;
                    bestBlob = currentBlob;
                }
                
                // Check if we've achieved target accuracy
                if (currentAccuracy >= 99) {
                    console.log(`Target achieved in ${iteration} iterations!`);
                    break;
                }
                
                // Adjust settings based on current result
                const sizeRatio = currentSize / targetBytes;
                
                if (sizeRatio > 1.02) {
                    // Current size is too large, increase compression
                    currentQuality *= 0.85;
                    currentScale *= 0.9;
                } else if (sizeRatio < 0.98) {
                    // Current size is too small, decrease compression
                    currentQuality = Math.min(0.95, currentQuality * 1.15);
                    currentScale = Math.min(1.0, currentScale * 1.1);
                } else {
                    // Very close, fine-tune
                    if (sizeRatio > 1.005) {
                        currentQuality *= 0.95;
                        currentScale *= 0.98;
                    } else if (sizeRatio < 0.995) {
                        currentQuality = Math.min(0.95, currentQuality * 1.05);
                        currentScale = Math.min(1.0, currentScale * 1.02);
                    }
                }
                
                // Ensure values are within bounds
                currentQuality = Math.max(0.1, Math.min(0.95, currentQuality));
                currentScale = Math.max(0.25, Math.min(1.0, currentScale));
                
                // Add small random variation to avoid local minima
                if (iteration > 2) {
                    currentQuality += (Math.random() - 0.5) * 0.05;
                    currentScale += (Math.random() - 0.5) * 0.03;
                    currentQuality = Math.max(0.1, Math.min(0.95, currentQuality));
                    currentScale = Math.max(0.25, Math.min(1.0, currentScale));
                }
                
                // Small delay to prevent UI freezing
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            return bestBlob;
        }

        // Set mode
        window.setMode = function(m) {
            mode = m;
            const autoControls = document.getElementById('autoControls');
            const specificControls = document.getElementById('specificControls');
            const optAuto = document.getElementById('optAuto');
            const optSpecific = document.getElementById('optSpecific');
            
            if (m === 'auto') {
                autoControls.style.display = 'block';
                specificControls.style.display = 'none';
                optAuto.style.borderColor = '#4361ee';
                optAuto.style.background = '#f0f4ff';
                optSpecific.style.borderColor = '#e5e7eb';
                optSpecific.style.background = '#f8f9fa';
            } else {
                autoControls.style.display = 'none';
                specificControls.style.display = 'block';
                optSpecific.style.borderColor = '#4361ee';
                optSpecific.style.background = '#f0f4ff';
                optAuto.style.borderColor = '#e5e7eb';
                optAuto.style.background = '#f8f9fa';
                
                if (currentFile) {
                    updateTargetInfo();
                }
            }
        };

        // File handling
        function handleFileSelect(file) {
            if (!file || file.type !== 'application/pdf') {
                alert('Please select a valid PDF file.');
                return;
            }

            if (file.size > 100 * 1024 * 1024) {
                alert('File size must be less than 100 MB.');
                return;
            }

            currentFile = file;
            fileName.textContent = file.name;
            fileSize.textContent = ` (${formatFileSize(file.size)})`;
            
            // Reset previous compression
            compressedBlob = null;
            downloadBtn.disabled = true;
            sizeComparison.style.display = 'none';
            successMessage.style.display = 'none';
            warningMessage.style.display = 'none';
            progressContainer.style.display = 'none';
            // hide share until next success
            if(typeof enableShare==='function') enableShare(false);
            accuracyInfo.style.display = 'none';
            iterationInfo.style.display = 'none';
            
            progressMessage.textContent = 'File ready for compression';
            
            if (mode === 'specific') {
                updateTargetInfo();
            }
        }

        // Drag and drop handlers
        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.style.borderColor = '#4361ee';
            dropzone.style.background = '#f0f4ff';
        });

        dropzone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropzone.style.borderColor = '#ddd';
            dropzone.style.background = '';
        });

        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.style.borderColor = '#ddd';
            dropzone.style.background = '';
            const file = e.dataTransfer.files[0];
            handleFileSelect(file);
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            handleFileSelect(file);
        });

        // Target value input handler
        document.getElementById('targetValue').addEventListener('input', updateTargetInfo);
        document.getElementById('targetUnit').addEventListener('change', updateTargetInfo);

        // ULTRA PRECISION PDF Compression with 99% Target Accuracy
        compressBtn.addEventListener('click', async () => {
            if (!currentFile) {
                alert('Please select a PDF file first.');
                return;
            }

            // Validate specific mode input
            if (mode === 'specific') {
                const targetBytes = calculateTargetBytes();
                if (!targetBytes) {
                    alert('Please enter a valid target size.');
                    return;
                }
                
                if (targetBytes >= currentFile.size) {
                    alert('Target size should be smaller than the original file size.');
                    return;
                }
                
                if (targetBytes < currentFile.size * 0.05) {
                    warningText.textContent = 'Warning: Target size is very small. Quality may be significantly reduced.';
                    warningMessage.style.display = 'block';
                } else {
                    warningMessage.style.display = 'none';
                }
            }

            compressBtn.disabled = true;
            downloadBtn.disabled = true;
            updateProgress(10, 'Starting ultra-precision compression...');

            try {
                const arrayBuffer = await currentFile.arrayBuffer();
                
                updateProgress(20, 'Loading PDF document...');

                // Load the PDF
                const pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                const numPages = pdfDoc.numPages;

                updateProgress(30, `Analyzing ${numPages} pages for optimal compression...`);

                if (mode === 'auto') {
                    // Standard compression for auto mode
                    const level = parseInt(document.getElementById('compressLevel').value) || 50;
                    const quality = 0.3 + (level / 100) * 0.4;
                    const scale = 0.5 + (level / 100) * 0.5;

                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF();
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    for (let i = 1; i <= numPages; i++) {
                        const progress = 30 + (i / numPages) * 60;
                        updateProgress(progress, `Compressing page ${i} of ${numPages}...`);

                        const page = await pdfDoc.getPage(i);
                        const viewport = page.getViewport({ scale: scale });
                        
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;

                        await page.render({
                            canvasContext: ctx,
                            viewport: viewport
                        }).promise;

                        const imgData = canvas.toDataURL('image/jpeg', quality);

                        if (i > 1) {
                            pdf.addPage();
                        }

                        const imgProps = pdf.getImageProperties(imgData);
                        const pdfWidth = pdf.internal.pageSize.getWidth();
                        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                        pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight, undefined, 'FAST');
                    }

                    updateProgress(95, 'Finalizing compression...');
                    compressedBlob = pdf.output('blob');
                } else {
                    // ULTRA PRECISION MODE with iterative optimization
                    const targetBytes = calculateTargetBytes();
                    compressedBlob = await compressWithPrecision(pdfDoc, targetBytes, 6);
                }

                // Show results
                const originalSizeBytes = currentFile.size;
                const compressedSizeBytes = compressedBlob.size;

                originalSize.textContent = formatFileSize(originalSizeBytes);
                compressedSizeElement.textContent = formatFileSize(compressedSizeBytes);
                sizeReduction.textContent = calculateReduction(originalSizeBytes, compressedSizeBytes);
                
                // Show target accuracy for specific mode
                if (mode === 'specific') {
                    const targetBytes = calculateTargetBytes();
                    const accuracy = 100 - (Math.abs(compressedSizeBytes - targetBytes) / targetBytes * 100);
                    accuracyValue.textContent = `${accuracy.toFixed(1)}%`;
                    
                    if (accuracy >= 99) {
                        accuracyValue.className = 'accuracy-perfect';
                        accuracyValue.innerHTML = `${accuracy.toFixed(1)}% ðŸŽ¯ PERFECT!`;
                    } else if (accuracy >= 97) {
                        accuracyValue.className = 'accuracy-perfect';
                        accuracyValue.innerHTML = `${accuracy.toFixed(1)}% â­ EXCELLENT`;
                    } else if (accuracy >= 95) {
                        accuracyValue.className = 'accuracy-excellent';
                    } else if (accuracy >= 90) {
                        accuracyValue.className = 'accuracy-good';
                    } else {
                        accuracyValue.className = 'accuracy-poor';
                    }
                    accuracyInfo.style.display = 'block';
                    iterationInfo.style.display = 'block';
                }
                
                sizeComparison.style.display = 'flex';
                successMessage.style.display = 'block';
                enableShare(true);
                
                if (mode === 'specific') {
                    const targetBytes = calculateTargetBytes();
                    const accuracy = 100 - (Math.abs(compressedSizeBytes - targetBytes) / targetBytes * 100);
                    if (accuracy >= 99) {
                        progressMessage.textContent = 'ðŸŽ¯ PERFECT! Target achieved with 99%+ accuracy!';
                    } else if (accuracy >= 95) {
                        progressMessage.textContent = 'â­ EXCELLENT! High-precision compression complete!';
                    } else {
                        progressMessage.textContent = 'Compression complete!';
                    }
                } else {
                    progressMessage.textContent = 'Compression complete!';
                }

                downloadBtn.disabled = false;
                compressBtn.disabled = false;

                // Hide progress bar after 2 seconds
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 2000);

            } catch (error) {
                console.error('Compression error:', error);
                alert('Compression failed. Please try again with a different file.');
                updateProgress(0, 'Compression failed');
                compressBtn.disabled = false;
                progressContainer.style.display = 'none';
            }
        });

        // Download handler
        downloadBtn.addEventListener('click', () => {
            if (!compressedBlob) {
                alert('Please compress the file first.');
                return;
            }

            const url = URL.createObjectURL(compressedBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentFile.name.replace('.pdf', '-compressed.pdf');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Range slider update
        document.getElementById('compressLevel').addEventListener('input', function() {
            document.getElementById('levelVal').textContent = this.value;
        });

        // Share helpers
        function getShareFile(){
            if(!compressedBlob) return null;
            const name = (currentFile?.name?.replace(/\.pdf$/i,'')||'document')+'-compressed.pdf';
            try{ return new File([compressedBlob], name, { type: 'application/pdf' }); }catch(_){ return null; }
        }
        function getShareUrl(){ return compressedBlob ? URL.createObjectURL(compressedBlob) : null; }
        function enableShare(enabled){
            const ids=['shareSection','shareWhatsApp','shareWeb','shareGmail','shareEmail','shareTelegram','sharePrint'];
            document.getElementById('shareSection').style.display = enabled? 'block':'none';
            ids.slice(1).forEach(id=>{ const el=document.getElementById(id); if(el) el.disabled = !enabled; });
        }

        // Share: WhatsApp (shares a link)
        document.getElementById('shareWhatsApp').addEventListener('click', ()=>{
            if(!compressedBlob) return;
            const url = getShareUrl();
            const text = encodeURIComponent(`Compressed PDF: ${currentFile?.name || 'document.pdf'}\nDownload: ${url}`);
            window.open(`https://wa.me/?text=${text}`, '_blank');
            setTimeout(()=>{ URL.revokeObjectURL(url); }, 15000);
        });

        // Share: Local (Web Share API)
        document.getElementById('shareWeb').addEventListener('click', async ()=>{
            if(!compressedBlob) return;
            const file = getShareFile();
            try{
                if(navigator.canShare && file && navigator.canShare({ files:[file] })){
                    await navigator.share({ title:'Compressed PDF', text:'Sharing compressed PDF', files:[file] });
                }else if(navigator.share){
                    const url = getShareUrl();
                    await navigator.share({ title:'Compressed PDF', text:'Download the compressed PDF', url });
                    setTimeout(()=>{ URL.revokeObjectURL(url); }, 15000);
                }else{
                    alert('Web Share is not supported on this device.');
                }
            }catch(e){ /* user canceled */ }
        });

        // Share: Gmail compose (opens compose with link)
        document.getElementById('shareGmail').addEventListener('click', ()=>{
            if(!compressedBlob) return;
            const url = getShareUrl();
            const subject = encodeURIComponent('Compressed PDF');
            const body = encodeURIComponent(`Here is the compressed PDF (${currentFile?.name||'document.pdf'}).\nDownload: ${url}`);
            window.open(`https://mail.google.com/mail/?view=cm&fs=1&su=${subject}&body=${body}`,'_blank');
            setTimeout(()=>{ URL.revokeObjectURL(url); }, 15000);
        });

        // Share: Email (mailto)
        document.getElementById('shareEmail').addEventListener('click', ()=>{
            if(!compressedBlob) return;
            const url = getShareUrl();
            const subject = encodeURIComponent('Compressed PDF');
            const body = encodeURIComponent(`Here is the compressed PDF (${currentFile?.name||'document.pdf'}).\nDownload: ${url}`);
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
            setTimeout(()=>{ URL.revokeObjectURL(url); }, 15000);
        });

        // Share: Telegram
        document.getElementById('shareTelegram').addEventListener('click', ()=>{
            if(!compressedBlob) return;
            const url = getShareUrl();
            const text = encodeURIComponent(`Compressed PDF: ${currentFile?.name || 'document.pdf'}`);
            window.open(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${text}`, '_blank');
            setTimeout(()=>{ URL.revokeObjectURL(url); }, 15000);
        });

        // Print: open in new tab and invoke print
        document.getElementById('sharePrint').addEventListener('click', ()=>{
            if(!compressedBlob) return;
            const url = getShareUrl();
            const w = window.open(url, '_blank');
            const timer = setInterval(()=>{ try{ if(w.document.readyState==='complete'){ clearInterval(timer); w.focus(); w.print(); } }catch(_){/* cross-origin blobs allow print */} }, 400);
        });

        // Initialize
        setMode('auto');
    </script>

    <div class="comments">
        <h2 class="section-title">User Comments</h2>
        <div class="comment-form">
            <div class="form-group">
                <label for="page-comment-name">Your Name</label>
                <input type="text" id="page-comment-name" class="form-control" placeholder="Enter your name">
            </div>
            <div class="form-group">
                <label for="page-comment-email">Email Address</label>
                <input type="email" id="page-comment-email" class="form-control" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="page-comment">Your Comment</label>
                <textarea id="page-comment" class="form-control" placeholder="Share your experience with this tool" rows="4"></textarea>
            </div>
            <button class="btn">Submit Comment</button>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Snap2PDF</h3>
                    <p>Your all-in-one PDF solution for converting, editing, and managing documents with ease.</p>
                </div>
                <div class="footer-column">
                    <h3>Convert to PDF</h3>
                    <ul class="footer-links">
                        <li><a href="jpg-to-pdf.html">JPG to PDF</a></li>
                        <li><a href="word-to-pdf.html">Word to PDF</a></li>
                        <li><a href="excel-to-pdf.html">Excel to PDF</a></li>
                        <li><a href="ppt-to-pdf.html">PowerPoint to PDF</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Convert from PDF</h3>
                    <ul class="footer-links">
                        <li><a href="pdf-to-jpg.html">PDF to JPG</a></li>
                        <li><a href="pdf-to-word.html">PDF to Word</a></li>
                        <li><a href="pdf-to-excel.html">PDF to Excel</a></li>
                        <li><a href="pdf-to-ppt.html">PDF to PowerPoint</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Edit PDF</h3>
                    <ul class="footer-links">
                        <li><a href="merge-pdf.html">Merge PDF</a></li>
                        <li><a href="split-pdf.html">Split PDF</a></li>
                        <li><a href="compress-pdf.html">Compress PDF</a></li>
                        <li><a href="edit-pdf.html">Edit PDF</a></li>
                        <li><a href="protect-pdf.html">Protect PDF</a></li>
                        <li><a href="unlock-pdf.html">Unlock PDF</a></li>
                        <li><a href="watermark-pdf.html">Watermark PDF</a></li>
                        <li><a href="crop-pdf.html">Crop PDF</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Image Tools</h3>
                    <ul class="footer-links">
                        <li><a href="image-compressor.html">Image Compressor</a></li>
                        <li><a href="image-resizer.html">Image Resizer</a></li>
                        <li><a href="image-editor.html">Image Editor</a></li>
                        <li><a href="background-remover.html">Background Remover</a></li>
                        <li><a href="ocr-image.html">OCR Image</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Design Tools</h3>
                    <ul class="footer-links">
                        <li><a href="resume-maker.html">Resume Maker</a></li>
                        <li><a href="biodata-maker.html">Biodata Maker</a></li>
                        <li><a href="ai-image-generator.html">AI Image Generator</a></li>
                        <li><a href="marriage-card.html">Marriage Card</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Company</h3>
                    <ul class="footer-links">
                        <li><a href="index.html#about">About Us</a></li>
                        <li><a href="index.html#contact">Contact</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Connect With Us</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fab fa-twitter"></i> Twitter</a></li>
                        <li><a href="#"><i class="fab fa-facebook"></i> Facebook</a></li>
                        <li><a href="#"><i class="fab fa-instagram"></i> Instagram</a></li>
                        <li><a href="#"><i class="fab fa-linkedin"></i> LinkedIn</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                
            <div class="copyright"><p class="attribution">Icons by Font Awesome (CC BY 4.0). Libraries: jsPDF (MIT), html2canvas (MIT), Mammoth (BSD-2-Clause). <a href="attributions.html">Details</a>.</p></div></div></footer>
</body>
</html>



